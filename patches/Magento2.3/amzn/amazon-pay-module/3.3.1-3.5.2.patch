--- a/Block/Widget/ResetPassword.php
+++ b/Block/Widget/ResetPassword.php
@@ -10,7 +10,7 @@ namespace Amazon\Payment\Block\Widget;
 
 use Magento\Framework\View\Element\Template;
 use Magento\Framework\View\Element\Template\Context;
-use Magento\Framework\UrlFactory;
+use Magento\Customer\Model\Url;
 use Magento\Customer\Model\Session;
 use Amazon\Login\Api\CustomerLinkRepositoryInterface;
 
@@ -28,13 +28,13 @@ class ResetPassword extends Template
 
     public function __construct(
         Context $context,
-        UrlFactory $urlFactory,
+        Url $urlModel,
         Session $session,
         CustomerLinkRepositoryInterface $customerLink,
         array $data = []
     ) {
         parent::__construct($context, $data);
-        $this->urlModel = $urlFactory->create();
+        $this->urlModel = $urlModel;
         $this->session = $session;
         $this->customerLink = $customerLink;
     }
@@ -63,7 +63,7 @@ class ResetPassword extends Template
 
     public function getLink()
     {
-        $url = $this->urlModel->getUrl('customer/account/forgotpassword');
+        $url = $this->urlModel->getLogoutUrl();
 
         return $url;
     }

--- a/Controller/Payment/CompleteCheckout.php
+++ b/Controller/Payment/CompleteCheckout.php
@@ -16,6 +16,7 @@
 namespace Amazon\Payment\Controller\Payment;
 
 use Amazon\Core\Exception\AmazonServiceUnavailableException;
+use Amazon\Core\Helper\Data as AmazonHelper;
 use Amazon\Core\Model\AmazonConfig;
 use Amazon\Core\Exception\AmazonWebapiException;
 use Amazon\Core\Logger\ExceptionLogger;
@@ -44,6 +45,11 @@ class CompleteCheckout extends Action
      */
     private $amazonConfig;
 
+    /**
+     * @var AmazonHelper
+     */
+    private $amazonHelper;
+
     /**
      * @var CheckoutSession
      */
@@ -74,6 +80,7 @@ class CompleteCheckout extends Action
      *
      * @param Context $context
      * @param AmazonConfig $amazonConfig
+     * @param AmazonHelper $amazonHelper
      * @param CartManagementInterface $cartManagement
      * @param GuestCartManagementInterface $guestCartManagement
      * @param CheckoutSession $checkoutSession
@@ -86,6 +93,7 @@ class CompleteCheckout extends Action
     public function __construct(
         Context $context,
         AmazonConfig $amazonConfig,
+        AmazonHelper $amazonHelper,
         CartManagementInterface $cartManagement,
         GuestCartManagementInterface $guestCartManagement,
         CheckoutSession $checkoutSession,
@@ -97,6 +105,7 @@ class CompleteCheckout extends Action
     ) {
         parent::__construct($context);
         $this->amazonConfig = $amazonConfig;
+        $this->amazonHelper = $amazonHelper;
         $this->cartManagement = $cartManagement;
         $this->checkoutSession = $checkoutSession;
         $this->session = $session;
@@ -114,6 +123,8 @@ class CompleteCheckout extends Action
     {
         try {
             $authenticationStatus = $this->getRequest()->getParam('AuthenticationStatus');
+            // Bypass cache check in \Magento\PageCache\Model\DepersonalizeChecker
+            $this->getRequest()->setParams(['ajax' => 1]);
             switch ($authenticationStatus) {
                 case 'Success':
                     try {
@@ -121,8 +132,20 @@ class CompleteCheckout extends Action
                             $this->checkoutSession->getQuote()->setCheckoutMethod(CartManagementInterface::METHOD_GUEST);
                         }
                         $this->cartManagement->placeOrder($this->checkoutSession->getQuoteId());
+                        if ($this->amazonHelper->getAuthorizationMode() == 'synchronous_possible') {
+                            $this->messageManager->addNoticeMessage(__(
+                                'Your transaction with Amazon Pay is currently being validated. ' .
+                                'Please be aware that we will inform you shortly as needed.'
+                            ));
+                        }
                         return $this->_redirect('checkout/onepage/success');
                     } catch (AmazonWebapiException $e) {
+                        if ($this->amazonConfig->isSoftDecline($e->getCode())) {
+                            return $this->_redirect('checkout', [
+                                '_query' => 'orderReferenceId=' . $this->getOrderReferenceId(),
+                                '_fragment' => 'payment',
+                            ]);
+                        }
                         $this->exceptionLogger->logException($e);
                         $this->messageManager->addErrorMessage($e->getMessage());
                     }
@@ -139,20 +162,18 @@ class CompleteCheckout extends Action
                         'The SCA challenge was not completed successfully.  '
                         . 'Please try again, or use a different payment method.'
                     ));
+                    return $this->_redirect('checkout', [
+                        '_query' => 'orderReferenceId=' . $this->getOrderReferenceId(),
+                        '_fragment' => 'payment',
+                    ]);
             }
 
-            $quote = $this->checkoutSession->getQuote();
-            if (!$quote) {
-                throw new NotFoundException(__('Failed to retrieve quote from checkoutSession'));
-            }
-            $orderReferenceId = $quote
-                ->getExtensionAttributes()
-                ->getAmazonOrderReferenceId()
-                ->getAmazonOrderReferenceId();
+            $orderReferenceId = $this->getOrderReferenceId();
+
             if ($orderReferenceId) {
                 // Cancel the order to prevent confusion when the merchant views Transactions in Seller Central
                 try {
-                    $this->orderInformationManagement->cancelOrderReference($orderReferenceId, $quote->getStoreId());
+                    $this->orderInformationManagement->cancelOrderReference($orderReferenceId, $this->checkoutSession->getQuote()->getStoreId());
                 } catch (AmazonServiceUnavailableException $e) {
                     $this->exceptionLogger->logException($e);
                 }
@@ -164,4 +185,24 @@ class CompleteCheckout extends Action
             throw $e;
         }
     }
+
+    /**
+     * Return Amazon order reference ID
+     *
+     * @return string
+     * @throws NotFoundException
+     * @throws \Magento\Framework\Exception\LocalizedException
+     * @throws \Magento\Framework\Exception\NoSuchEntityException
+     */
+    private function getOrderReferenceId()
+    {
+        $quote = $this->checkoutSession->getQuote();
+        if (!$quote) {
+            throw new NotFoundException(__('Failed to retrieve quote from checkoutSession'));
+        }
+        return $quote
+            ->getExtensionAttributes()
+            ->getAmazonOrderReferenceId()
+            ->getAmazonOrderReferenceId();
+    }
 }

--- a/Domain/AmazonSetOrderDetailsResponse.php
+++ b/Domain/AmazonSetOrderDetailsResponse.php
@@ -30,7 +30,11 @@ class AmazonSetOrderDetailsResponse
         $data = $response->toArray();
 
         if (200 != $data['ResponseStatus']) {
-            throw new AmazonServiceUnavailableException();
+            throw new AmazonServiceUnavailableException(
+                $data['Error']['Type'],
+                $data['Error']['Code'],
+                $data['Error']['Message']
+            );
         }
 
         $details = $data['SetOrderReferenceDetailsResult']['OrderReferenceDetails'];

--- a/Gateway/Config/Config.php
+++ b/Gateway/Config/Config.php
@@ -11,6 +11,42 @@ class Config extends \Magento\Payment\Gateway\Config\Config
     
     const KEY_ACTIVE = 'active';
 
+    /**
+     * @var \Amazon\Core\Model\AmazonConfig
+     */
+    protected $amazonConfig;
+
+    /**
+     * @param \Amazon\Core\Model\AmazonConfig $amazonConfig
+     * @param \Magento\Framework\App\Config\ScopeConfigInterface $scopeConfig
+     */
+    public function __construct(
+        \Amazon\Core\Model\AmazonConfig $amazonConfig,
+        \Magento\Framework\App\Config\ScopeConfigInterface $scopeConfig
+    ) {
+        $this->amazonConfig = $amazonConfig;
+        parent::__construct($scopeConfig, self::CODE);
+    }
+
+    /**
+     * @param int|null $storeId
+     * @return boolean
+     */
+    protected function canCapturePartial($storeId = null)
+    {
+        $region = $this->amazonConfig->getPaymentRegion(\Magento\Store\Model\ScopeInterface::SCOPE_STORE, $storeId);
+        switch ($region) {
+            case 'de':
+            case 'uk':
+                $result = false;
+                break;
+            default:
+                $result = parent::getValue('can_capture_partial', $storeId);
+                break;
+        }
+        return $result;
+    }
+
     /**
      * Gets Payment configuration status.
      *
@@ -21,4 +57,22 @@ class Config extends \Magento\Payment\Gateway\Config\Config
     {
         return (bool) $this->getValue(self::KEY_ACTIVE, $storeId);
     }
+
+    /**
+     * @param string $field
+     * @param int|null $storeId
+     * @return mixed
+     */
+    public function getValue($field, $storeId = null)
+    {
+        switch ($field) {
+            case 'can_capture_partial':
+                $result = $this->canCapturePartial($storeId);
+                break;
+            default:
+                $result = parent::getValue($field, $storeId);
+                break;
+        }
+        return $result;
+    }
 }

--- a/Gateway/Request/AuthorizationRequestBuilder.php
+++ b/Gateway/Request/AuthorizationRequestBuilder.php
@@ -18,7 +18,6 @@ namespace Amazon\Payment\Gateway\Request;
 
 use Magento\Payment\Gateway\ConfigInterface;
 use Magento\Payment\Gateway\Request\BuilderInterface;
-use Magento\Framework\App\ProductMetadata;
 use Amazon\Payment\Gateway\Helper\SubjectReader;
 use Amazon\Core\Helper\Data;
 use Amazon\Core\Model\AmazonConfig;
@@ -34,11 +33,6 @@ class AuthorizationRequestBuilder implements BuilderInterface
      */
     private $config;
 
-    /**
-     * @var ProductMetadata
-     */
-    private $productMetaData;
-
     /**
      * @var SubjectReader
      */
@@ -68,7 +62,6 @@ class AuthorizationRequestBuilder implements BuilderInterface
      * AuthorizationRequestBuilder constructor.
      *
      * @param ConfigInterface $config
-     * @param ProductMetadata $productMetadata
      * @param SubjectReader $subjectReader
      * @param Data $coreHelper
      * @param AmazonConfig $amazonConfig
@@ -77,7 +70,6 @@ class AuthorizationRequestBuilder implements BuilderInterface
      */
     public function __construct(
         ConfigInterface $config,
-        ProductMetaData $productMetadata,
         SubjectReader $subjectReader,
         Data $coreHelper,
         AmazonConfig $amazonConfig,
@@ -87,7 +79,6 @@ class AuthorizationRequestBuilder implements BuilderInterface
         $this->config = $config;
         $this->coreHelper = $coreHelper;
         $this->amazonConfig = $amazonConfig;
-        $this->productMetaData = $productMetadata;
         $this->subjectReader = $subjectReader;
         $this->eventManager = $eventManager;
         $this->categoryExclusion = $categoryExclusion;
@@ -152,7 +143,7 @@ class AuthorizationRequestBuilder implements BuilderInterface
                     'currency_code' => $currencyCode,
                     'store_name' => $storeName,
                     'custom_information' =>
-                        'Magento Version : ' . $this->productMetaData->getVersion() . ' ' .
+                        'Magento Version : 2, ' .
                         'Plugin Version : ' . $this->coreHelper->getVersion(),
                     'platform_id' => $this->config->getValue('platform_id'),
                     'request_payment_authorization' => true

--- a/Gateway/Request/SettlementRequestBuilder.php
+++ b/Gateway/Request/SettlementRequestBuilder.php
@@ -18,7 +18,6 @@ namespace Amazon\Payment\Gateway\Request;
 
 use Amazon\Payment\Gateway\Config\Config;
 use Magento\Payment\Gateway\Request\BuilderInterface;
-use Magento\Framework\App\ProductMetadata;
 use Amazon\Payment\Gateway\Helper\SubjectReader;
 use Amazon\Core\Helper\Data;
 use Magento\Payment\Model\Method\Logger;
@@ -37,11 +36,6 @@ class SettlementRequestBuilder implements BuilderInterface
      */
     private $logger;
 
-    /**
-     * @var ProductMetadata
-     */
-    private $productMetaData;
-
     /**
      * @var SubjectReader
      */
@@ -66,7 +60,6 @@ class SettlementRequestBuilder implements BuilderInterface
      * SettlementRequestBuilder constructor.
      *
      * @param Config $config
-     * @param ProductMetadata $productMetadata
      * @param OrderRepositoryInterface $orderRepository
      * @param CartRepositoryInterface $quoteRepository
      * @param SubjectReader $subjectReader
@@ -75,7 +68,6 @@ class SettlementRequestBuilder implements BuilderInterface
      */
     public function __construct(
         Config $config,
-        ProductMetaData $productMetadata,
         OrderRepositoryInterface $orderRepository,
         CartRepositoryInterface $quoteRepository,
         SubjectReader $subjectReader,
@@ -86,7 +78,6 @@ class SettlementRequestBuilder implements BuilderInterface
         $this->orderRepository = $orderRepository;
         $this->quoteRepository = $quoteRepository;
         $this->coreHelper = $coreHelper;
-        $this->productMetaData = $productMetadata;
         $this->subjectReader = $subjectReader;
         $this->logger = $logger;
     }
@@ -123,7 +114,7 @@ class SettlementRequestBuilder implements BuilderInterface
                     'store_id' => $buildSubject['multicurrency']['store_id'],
                     'store_name' => $buildSubject['multicurrency']['store_name'],
                     'custom_information' =>
-                        'Magento Version : ' . $this->productMetaData->getVersion() . ' ' .
+                        'Magento Version : 2, ' .
                         'Plugin Version : ' . $this->coreHelper->getVersion(),
                     'platform_id' => $this->config->getValue('platform_id'),
                     'request_payment_authorization' => false

--- a/Model/Adapter/AmazonPaymentAdapter.php
+++ b/Model/Adapter/AmazonPaymentAdapter.php
@@ -241,7 +241,6 @@ class AmazonPaymentAdapter
     public function authorize($data, $captureNow = false, $attempts = 0)
     {
         $response = [];
-        $confirmResponse = null;
         $order = $this->getOrderByReference($data['amazon_order_reference_id']);
         if ($order) {
             $storeId = $order->getStoreId();
@@ -280,56 +279,38 @@ class AmazonPaymentAdapter
         $response['constraints'] = [];
         $response['amazon_order_reference_id'] = $data['amazon_order_reference_id'];
 
-        $confirmResponse = $this->confirmOrderReference($storeId, $data['amazon_order_reference_id']);
-
-        if ($confirmResponse->response['Status'] == 200) {
-            $authorizeResponse = $this->getAuthorization($storeId, $authorizeData);
-
-            if ($authorizeResponse) {
-                if ($authorizeResponse->getCaptureTransactionId() || $authorizeResponse->getAuthorizeTransactionId()) {
-                    $response['authorize_transaction_id'] = $authorizeResponse->getAuthorizeTransactionId();
-
-                    if ($authorizeResponse->getStatus()->getState() == 'Pending' && $authMode == 'synchronous_possible') {
-                        if ($captureNow) {
-                            $response['capture_transaction_id'] = $authorizeResponse->getCaptureTransactionId();
-                        }
-                        $response['response_code'] = 'TransactionTimedOut';
-                    } elseif (!in_array($authorizeResponse->getStatus()->getState(), self::SUCCESS_CODES)) {
-                        $response['response_code'] = $authorizeResponse->getStatus()->getReasonCode();
-                        if ($authMode == 'synchronous' && $authorizeResponse->getStatus()->getReasonCode() == 'TransactionTimedOut') {
-                            $cancelData = [
-                                'store_id' => $storeId,
-                                'amazon_order_reference_id' => $data['amazon_order_reference_id']
-                            ];
-                            $this->clientFactory->create($storeId)->cancelOrderReference($cancelData);
-                        }
-                    } else {
-                        $response['status'] = true;
-
-                        if ($captureNow) {
-                            $response['capture_transaction_id'] = $authorizeResponse->getCaptureTransactionId();
-                        }
-                    }
-                } else {
-                    $response['status'] = false;
-                    $response['response_status'] = $authorizeResponse->getStatus()->getState();
-                    $response['response_code'] = $authorizeResponse->getStatus()->getReasonCode();
-                    $log['error'] = $authorizeResponse->getStatus()->getState() . ': ' . $authorizeResponse->getStatus()->getReasonCode();
-                    $this->logger->debug($log);
-                }
-            }
-        } else {
-            /** something went wrong, parse response body for use by authorization validator */
-            $response['response_status'] = $confirmResponse->response['Status'];
+        $authorizeResponse = $this->getAuthorization($storeId, $authorizeData);
+
+        if ($authorizeResponse->getCaptureTransactionId() || $authorizeResponse->getAuthorizeTransactionId()) {
+            $response['authorize_transaction_id'] = $authorizeResponse->getAuthorizeTransactionId();
 
-            $xml = simplexml_load_string($confirmResponse->response['ResponseBody']);
-            $code = $xml->Error->Code[0];
-            if ($code) {
-                $response['response_code'] = (string)$code;
+            if ($authorizeResponse->getStatus()->getState() == 'Pending' && $authMode == 'synchronous_possible') {
+                if ($captureNow) {
+                    $response['capture_transaction_id'] = $authorizeResponse->getCaptureTransactionId();
+                }
+                $response['response_code'] = 'TransactionTimedOut';
+            } elseif (!in_array($authorizeResponse->getStatus()->getState(), self::SUCCESS_CODES)) {
+                $response['response_code'] = $authorizeResponse->getStatus()->getReasonCode();
+                if ($authMode == 'synchronous' && $authorizeResponse->getStatus()->getReasonCode() == 'TransactionTimedOut') {
+                    $cancelData = [
+                        'store_id' => $storeId,
+                        'amazon_order_reference_id' => $data['amazon_order_reference_id']
+                    ];
+                    $this->clientFactory->create($storeId)->cancelOrderReference($cancelData);
+                }
             } else {
-                $log['error'] = __('AmazonPaymentAdapter: Improperly formatted XML response, no response code available.');
-                $this->logger->debug($log);
+                $response['status'] = true;
+
+                if ($captureNow) {
+                    $response['capture_transaction_id'] = $authorizeResponse->getCaptureTransactionId();
+                }
             }
+        } else {
+            $response['status'] = false;
+            $response['response_status'] = $authorizeResponse->getStatus()->getState();
+            $response['response_code'] = $authorizeResponse->getStatus()->getReasonCode();
+            $log['error'] = $authorizeResponse->getStatus()->getState() . ': ' . $authorizeResponse->getStatus()->getReasonCode();
+            $this->logger->debug($log);
         }
 
         if ($additionalInformation) {

--- a/Model/AddressManagement.php
+++ b/Model/AddressManagement.php
@@ -21,8 +21,11 @@ use Amazon\Core\Exception\AmazonServiceUnavailableException;
 use Amazon\Payment\Api\AddressManagementInterface;
 use Amazon\Payment\Api\Data\QuoteLinkInterfaceFactory;
 use Amazon\Payment\Helper\Address;
+use Amazon\Payment\Domain\AmazonOrderStatus;
+use Amazon\Payment\Domain\AmazonAuthorizationStatus;
 use Exception;
 use Magento\Checkout\Model\Session;
+use Magento\Customer\Model\AddressFactory;
 use Magento\Directory\Model\ResourceModel\Country\CollectionFactory;
 use Magento\Framework\Exception\SessionException;
 use Magento\Framework\Validator\Exception as ValidatorException;
@@ -77,6 +80,11 @@ class AddressManagement implements AddressManagementInterface
      */
     private $logger;
 
+    /**
+     * @var AddressFactory
+     */
+    private $addressFactory;
+
     /**
      * @param ClientFactoryInterface    $clientFactory
      * @param Address                   $addressHelper
@@ -86,6 +94,7 @@ class AddressManagement implements AddressManagementInterface
      * @param AmazonAddressFactory      $amazonAddressFactory
      * @param Factory                   $validatorFactory
      * @param LoggerInterface           $logger
+     * @param AddressFactory            $addressFactory
      */
     public function __construct(
         ClientFactoryInterface $clientFactory,
@@ -95,7 +104,8 @@ class AddressManagement implements AddressManagementInterface
         CollectionFactory $countryCollectionFactory,
         AmazonAddressFactory $amazonAddressFactory,
         Factory $validatorFactory,
-        LoggerInterface $logger
+        LoggerInterface $logger,
+        AddressFactory $addressFactory
     ) {
         $this->clientFactory            = $clientFactory;
         $this->addressHelper            = $addressHelper;
@@ -105,6 +115,7 @@ class AddressManagement implements AddressManagementInterface
         $this->amazonAddressFactory     = $amazonAddressFactory;
         $this->validatorFactory         = $validatorFactory;
         $this->logger                   = $logger;
+        $this->addressFactory           = $addressFactory;
     }
 
     /**
@@ -115,6 +126,11 @@ class AddressManagement implements AddressManagementInterface
         try {
             $data = $this->getOrderReferenceDetails($amazonOrderReferenceId, $addressConsentToken);
 
+            if ($this->isSuspendedStatus($data)) {
+                throw new WebapiException(__('There has been a problem with the selected payment method on your ' .
+                    'Amazon account. Please choose another one.'));
+            }
+
             $this->updateQuoteLink($amazonOrderReferenceId);
 
             if (isset($data['OrderReferenceDetails']['Destination']['PhysicalDestination'])) {
@@ -146,6 +162,9 @@ class AddressManagement implements AddressManagementInterface
 
             $this->updateQuoteLink($amazonOrderReferenceId);
 
+            // Re-open suspended InvalidPaymentMethod decline during ConfirmOrderReference
+            $this->session->setData('is_amazon_suspended', $this->isSuspendedStatus($data));
+
             if (isset($data['OrderReferenceDetails']['BillingAddress']['PhysicalAddress'])) {
                 $billingAddress = $data['OrderReferenceDetails']['BillingAddress']['PhysicalAddress'];
                 if (!isset($billingAddress['Phone']) || !$billingAddress['Phone']) {
@@ -199,6 +218,13 @@ class AddressManagement implements AddressManagementInterface
             if (1 != $collectionSize) {
                 throw new WebapiException(__('the country for your address is not allowed for this store'));
             }
+
+            // Validate address
+            $validate = $this->addressFactory->create()->updateData($magentoAddress)->validate();
+            if (is_array($validate)) {
+                $validate[] = __('Your address may be updated in your Amazon account.');
+                throw new ValidatorException(null, null, [$validate]);
+            }
         }
 
         return [$this->addressHelper->convertToArray($magentoAddress)];
@@ -245,4 +271,12 @@ class AddressManagement implements AddressManagementInterface
                 ->save();
         }
     }
+
+    protected function isSuspendedStatus($data)
+    {
+        $orderStatus = $data['OrderReferenceDetails']['OrderReferenceStatus'] ?? false;
+
+        return ($orderStatus && $orderStatus['State'] == AmazonOrderStatus::STATE_SUSPENDED
+            && $orderStatus['ReasonCode'] == AmazonAuthorizationStatus::REASON_INVALID_PAYMENT_METHOD);
+    }
 }

--- a/Model/OrderInformationManagement.php
+++ b/Model/OrderInformationManagement.php
@@ -25,7 +25,6 @@ use Amazon\Payment\Domain\AmazonSetOrderDetailsResponse;
 use Amazon\Payment\Domain\AmazonSetOrderDetailsResponseFactory;
 use Exception;
 use Magento\Checkout\Model\Session;
-use Magento\Framework\App\ProductMetadata;
 use Magento\Framework\Exception\LocalizedException;
 use Magento\Framework\Exception\ValidatorException;
 use Magento\Quote\Model\Quote;
@@ -75,11 +74,6 @@ class OrderInformationManagement implements OrderInformationManagementInterface
      */
     private $config;
 
-    /**
-     * @var ProductMetadata
-     */
-    private $productMetadata;
-
     /**
      * OrderInformationManagement constructor.
      * @param Session $session
@@ -89,7 +83,6 @@ class OrderInformationManagement implements OrderInformationManagementInterface
      * @param AmazonSetOrderDetailsResponseFactory $amazonSetOrderDetailsResponseFactory
      * @param QuoteLinkInterfaceFactory $quoteLinkFactory
      * @param LoggerInterface $logger
-     * @param ProductMetadata $productMetadata
      */
     public function __construct(
         Session $session,
@@ -99,7 +92,6 @@ class OrderInformationManagement implements OrderInformationManagementInterface
         AmazonSetOrderDetailsResponseFactory $amazonSetOrderDetailsResponseFactory,
         QuoteLinkInterfaceFactory $quoteLinkFactory,
         LoggerInterface $logger,
-        ProductMetadata $productMetadata,
         UrlInterface $urlBuilder = null
     ) {
         $this->session                              = $session;
@@ -109,7 +101,6 @@ class OrderInformationManagement implements OrderInformationManagementInterface
         $this->amazonSetOrderDetailsResponseFactory = $amazonSetOrderDetailsResponseFactory;
         $this->quoteLinkFactory                     = $quoteLinkFactory;
         $this->logger                               = $logger;
-        $this->productMetadata                      = $productMetadata;
         $this->urlBuilder = $urlBuilder ?: ObjectManager::getInstance()->get(UrlInterface::class);
     }
 
@@ -137,18 +128,16 @@ class OrderInformationManagement implements OrderInformationManagementInterface
                 'currency_code'             => $quote->getQuoteCurrencyCode(),
                 'store_name'                => $storeName,
                 'custom_information'        =>
-                    'Magento Version : ' . $this->productMetadata->getVersion() . ' ' .
+                    'Magento Version : 2, ' .
                     'Plugin Version : ' . $this->coreHelper->getVersion()
                 ,
                 'platform_id'               => $this->config->getValue('platform_id')
             ];
 
             $responseParser = $this->clientFactory->create($storeId)->setOrderReferenceDetails($data);
-            $response       = $this->amazonSetOrderDetailsResponseFactory->create(
-                [
+            $response = $this->amazonSetOrderDetailsResponseFactory->create([
                 'response' => $responseParser
-                ]
-            );
+            ]);
 
             $this->validateConstraints($response, $allowedConstraints);
         } catch (LocalizedException $e) {

--- a/Observer/IgnoreBillingAddressValidation.php
+++ b/Observer/IgnoreBillingAddressValidation.php
@@ -26,6 +26,7 @@ class IgnoreBillingAddressValidation implements ObserverInterface
         $quote = $observer->getEvent()->getQuote();
         if (AmazonPayment::CODE === $quote->getPayment()->getMethod()) {
             $quote->getBillingAddress()->setShouldIgnoreValidation(true);
+            $quote->getShippingAddress()->setShouldIgnoreValidation(true);
         }
     }
 }

--- a/Plugin/CheckoutProcessor.php
+++ b/Plugin/CheckoutProcessor.php
@@ -62,12 +62,6 @@ class CheckoutProcessor
         ['children']['payment'];
 
         if (!$quote->isVirtual() && $this->amazonHelper->isPwaEnabled()) {
-            $shippingConfig['component'] = 'Amazon_Payment/js/view/shipping';
-            $shippingConfig['children']['customer-email']['component'] = 'Amazon_Payment/js/view/form/element/email';
-            $shippingConfig['children']['address-list']['component'] = 'Amazon_Payment/js/view/shipping-address/list';
-            $shippingConfig['children']['shipping-address-fieldset']['children']
-            ['inline-form-manipulator']['component'] = 'Amazon_Payment/js/view/shipping-address/inline-form';
-
             $paymentConfig['children']['payments-list']['component'] = 'Amazon_Payment/js/view/payment/list';
         } else {
             unset($shippingConfig['children']['customer-email']['children']['amazon-button-region']);

--- a/Plugin/ConfirmOrderReference.php
+++ b/Plugin/ConfirmOrderReference.php
@@ -25,6 +25,7 @@ use Amazon\Payment\Model\Adapter\AmazonPaymentAdapter;
 use Amazon\Payment\Model\OrderInformationManagement;
 use Magento\Quote\Api\Data\PaymentInterface;
 use Magento\Quote\Api\Data\AddressInterface;
+use Magento\Framework\Webapi\Rest\Request;
 use Magento\Framework\Exception\LocalizedException;
 use Amazon\Payment\Gateway\Config\Config as GatewayConfig;
 use Magento\Quote\Api\CartRepositoryInterface;
@@ -41,6 +42,11 @@ class ConfirmOrderReference
      */
     private $checkoutSession;
 
+    /**
+     * @var Request
+     */
+    private $request;
+
     /**
      * @var OrderInformationManagement
      */
@@ -54,19 +60,31 @@ class ConfirmOrderReference
     /**
      * ConfirmOrderReference constructor.
      * @param Session $checkoutSession
+     * @param Request $request
      * @param OrderInformationManagement $orderInformationManagement
      * @param CartRepositoryInterface $quoteRepository
      */
     public function __construct(
         Session $checkoutSession,
+        Request $request,
         OrderInformationManagement $orderInformationManagement,
         CartRepositoryInterface $quoteRepository
     ) {
         $this->checkoutSession = $checkoutSession;
+        $this->request = $request;
         $this->orderInformationManagement = $orderInformationManagement;
         $this->quoteRepository = $quoteRepository;
     }
 
+    /**
+     * @return boolean
+     */
+    protected function canConfirmOrderReference()
+    {
+        $data = $this->request->getRequestData();
+        return !empty($data['confirmOrder']);
+    }
+
     /**
      * @param PaymentMethodManagementInterface $subject
      * @param $result
@@ -90,11 +108,16 @@ class ConfirmOrderReference
                     ->getAmazonOrderReferenceId()
                     ->getAmazonOrderReferenceId();
 
-                $this->orderInformationManagement->saveOrderInformation($amazonOrderReferenceId);
-                $this->orderInformationManagement->confirmOrderReference(
-                    $amazonOrderReferenceId,
-                    $quote->getStoreId()
-                );
+                if (!$this->checkoutSession->getData('is_amazon_suspended')) {
+                    $this->orderInformationManagement->saveOrderInformation($amazonOrderReferenceId);
+                }
+
+                if ($this->canConfirmOrderReference()) {
+                    $this->orderInformationManagement->confirmOrderReference(
+                        $amazonOrderReferenceId,
+                        $quote->getStoreId()
+                    );
+                }
             }
         }
 

--- /dev/null
+++ b/Test/Mftf/Data/AmazonAddressData.xml
@@ -0,0 +1,14 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+          xsi:noNamespaceSchemaLocation="urn:magento:mftf:DataGenerator/etc/dataProfileSchema.xsd">
+    <!--"Fail Address" to trigger Magento shipping address validation error-->
+    <entity name="AmazonAddressFail" type="amazon_address">
+        <data key="country">BQ</data>
+        <data key="name">Bonaire International Airport</data>
+        <data key="address">Plasa Medardo SV Thielman 1</data>
+        <data key="city">Kralendijk</data>
+        <data key="region">Caribbean Netherlands</data>
+        <data key="postal">12345</data>
+        <data key="phone">+555 555 5555</data>
+    </entity>
+</entities>

--- /dev/null
+++ b/Test/Mftf/Data/AmazonCountryData.xml
@@ -0,0 +1,15 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:DataGenerator/etc/dataProfileSchema.xsd">
+    <entity name="SingleCountryAllowConfig" type="amazon_country_allow_config">
+        <requiredEntity type="allow">SingleCountryAllowValue</requiredEntity>
+    </entity>
+    <entity name="SingleCountryAllowValue" type="allow">
+        <data key="value">US</data>
+    </entity>
+    <entity name="DefaultCountryAllowConfig" type="default_amazon_country_allow_config">
+        <requiredEntity type="amazonCountryAllowFlagZero">DefaultCountryAllowFlagZero</requiredEntity>
+    </entity>
+    <entity name="DefaultCountryAllowFlagZero" type="amazonCountryAllowFlagZero">
+        <data key="value">1</data>
+    </entity>
+</entities>

--- /dev/null
+++ b/Test/Mftf/Data/AmazonCurrencyData.xml
@@ -0,0 +1,45 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<entities xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:DataGenerator/etc/dataProfileSchema.xsd">
+    <entity name="AmazonAllowCurrencyValue" type="allow">
+        <array key="value">
+            <item>USD</item>
+            <item>EUR</item>
+        </array>
+    </entity>
+    <entity name="MultiInvoiceAmazonCurrencyConfig" type="amazon_currency_config">
+        <requiredEntity type="base">MultiInvoiceAmazonBaseCurrencyValue</requiredEntity>
+        <requiredEntity type="default">MultiInvoiceAmazonDefaultCurrencyValue</requiredEntity>
+        <requiredEntity type="allow">AmazonAllowCurrencyValue</requiredEntity>
+    </entity>
+    <entity name="MultiInvoiceAmazonBaseCurrencyValue" type="base">
+        <data key="value">USD</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonDefaultCurrencyValue" type="default">
+        <data key="value">USD</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonCurrencyConfig" type="amazon_currency_config">
+        <requiredEntity type="base">SingleInvoiceAmazonBaseCurrencyValue</requiredEntity>
+        <requiredEntity type="default">SingleInvoiceAmazonDefaultCurrencyValue</requiredEntity>
+        <requiredEntity type="allow">AmazonAllowCurrencyValue</requiredEntity>
+    </entity>
+    <entity name="SingleInvoiceAmazonBaseCurrencyValue" type="base">
+        <data key="value">EUR</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonDefaultCurrencyValue" type="default">
+        <data key="value">EUR</data>
+    </entity>
+    <entity name="DefaultAmazonCurrencyConfig" type="default_amazon_currency_config">
+        <requiredEntity type="amazonCurrencyBaseFlagZero">DefaultAmazonCurrencyBaseFlagZero</requiredEntity>
+        <requiredEntity type="amazonCurrencyDefaultFlagZero">DefaultAmazonCurrencyDefaultFlagZero</requiredEntity>
+        <requiredEntity type="amazonCurrencyAllowFlagZero">DefaultAmazonCurrencyAllowFlagZero</requiredEntity>
+    </entity>
+    <entity name="DefaultAmazonCurrencyBaseFlagZero" type="amazonCurrencyBaseFlagZero">
+        <data key="value">1</data>
+    </entity>
+    <entity name="DefaultAmazonCurrencyDefaultFlagZero" type="amazonCurrencyDefaultFlagZero">
+        <data key="value">1</data>
+    </entity>
+    <entity name="DefaultAmazonCurrencyAllowFlagZero" type="amazonCurrencyAllowFlagZero">
+        <data key="value">1</data>
+    </entity>
+</entities>

--- a/Test/Mftf/Data/AmazonPaymentData.xml
+++ b/Test/Mftf/Data/AmazonPaymentData.xml
@@ -47,6 +47,70 @@
     <entity name="SampleAmazonLwaEnabled" type="lwa_enabled">
         <data key="value">1</data>
     </entity>
+    <!-- Partial capture support configuration -->
+    <entity name="MultiInvoiceAmazonPaymentConfig" type="amazon_payment_config_state">
+        <requiredEntity type="merchant_id">MultiInvoiceAmazonMerchantId</requiredEntity>
+        <requiredEntity type="access_key">MultiInvoiceAmazonAccessKey</requiredEntity>
+        <requiredEntity type="secret_key">MultiInvoiceAmazonSecretKey</requiredEntity>
+        <requiredEntity type="client_id">MultiInvoiceAmazonClientId</requiredEntity>
+        <requiredEntity type="client_secret">MultiInvoiceAmazonClientSecret</requiredEntity>
+        <requiredEntity type="payment_region">MultiInvoiceAmazonPaymentRegion</requiredEntity>
+        <requiredEntity type="sandbox">SampleAmazonSandbox</requiredEntity>
+        <requiredEntity type="payment_action">SampleAmazonPaymentAction</requiredEntity>
+        <requiredEntity type="authorization_mode">SampleAmazonAuthorizationMode</requiredEntity>
+        <requiredEntity type="amazon_pay_active">SampleAmazonPayActive</requiredEntity>
+        <requiredEntity type="lwa_enabled">DefaultAmazonLwaEnabled</requiredEntity>
+    </entity>
+    <entity name="MultiInvoiceAmazonMerchantId" type="merchant_id">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_merchant_id}}</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonAccessKey" type="access_key">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_access_key}}</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonSecretKey" type="secret_key">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_secret_key}}</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonClientId" type="client_id">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_client_id}}</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonClientSecret" type="client_secret">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_client_secret}}</data>
+    </entity>
+    <entity name="MultiInvoiceAmazonPaymentRegion" type="payment_region">
+        <data key="value">{{_CREDS.amazon/v1_multi_invoice_region}}</data>
+    </entity>
+    <!-- No partial capture support configuration -->
+    <entity name="SingleInvoiceAmazonPaymentConfig" type="amazon_payment_config_state">
+        <requiredEntity type="merchant_id">SingleInvoiceAmazonMerchantId</requiredEntity>
+        <requiredEntity type="access_key">SingleInvoiceAmazonAccessKey</requiredEntity>
+        <requiredEntity type="secret_key">SingleInvoiceAmazonSecretKey</requiredEntity>
+        <requiredEntity type="client_id">SingleInvoiceAmazonClientId</requiredEntity>
+        <requiredEntity type="client_secret">SingleInvoiceAmazonClientSecret</requiredEntity>
+        <requiredEntity type="payment_region">SingleInvoiceAmazonPaymentRegion</requiredEntity>
+        <requiredEntity type="sandbox">SampleAmazonSandbox</requiredEntity>
+        <requiredEntity type="payment_action">SampleAmazonPaymentAction</requiredEntity>
+        <requiredEntity type="authorization_mode">SampleAmazonAuthorizationMode</requiredEntity>
+        <requiredEntity type="amazon_pay_active">SampleAmazonPayActive</requiredEntity>
+        <requiredEntity type="lwa_enabled">DefaultAmazonLwaEnabled</requiredEntity>
+    </entity>
+    <entity name="SingleInvoiceAmazonMerchantId" type="merchant_id">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_merchant_id}}</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonAccessKey" type="access_key">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_access_key}}</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonSecretKey" type="secret_key">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_secret_key}}</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonClientId" type="client_id">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_client_id}}</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonClientSecret" type="client_secret">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_client_secret}}</data>
+    </entity>
+    <entity name="SingleInvoiceAmazonPaymentRegion" type="payment_region">
+        <data key="value">{{_CREDS.amazon/v1_single_invoice_region}}</data>
+    </entity>
     <!-- default configuration used to restore Magento config -->
     <entity name="DefaultAmazonPaymentConfig" type="amazon_payment_config_state">
         <requiredEntity type="merchant_id">DefaultAmazonMerchantId</requiredEntity>

--- /dev/null
+++ b/Test/Mftf/Metadata/amazon_country_config-meta.xml
@@ -0,0 +1,27 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<operations xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:DataGenerator/etc/dataOperation.xsd">
+    <operation name="AmazonCountryAllowConfig" dataType="amazon_country_allow_config" type="create" auth="adminFormKey" url="/admin/system_config/save/section/general/" method="POST">
+        <object key="groups" dataType="amazon_country_allow_config">
+            <object key="country" dataType="amazon_country_allow_config">
+                <object key="fields" dataType="amazon_country_allow_config">
+                    <object key="allow" dataType="allow">
+                        <field key="value">string</field>
+                    </object>
+                </object>
+            </object>
+        </object>
+    </operation>
+    <operation name="DefaultAmazonCountryAllowConfig" dataType="default_amazon_country_allow_config" type="create" auth="adminFormKey" url="/admin/system_config/save/section/general/" method="POST">
+        <object key="groups" dataType="default_amazon_country_allow_config">
+            <object key="country" dataType="default_amazon_country_allow_config">
+                <object key="fields" dataType="default_amazon_country_allow_config">
+                    <object key="allow" dataType="default_amazon_country_allow_config">
+                        <object key="inherit" dataType="amazonCountryAllowFlagZero">
+                            <field key="value">integer</field>
+                        </object>
+                    </object>
+                </object>
+            </object>
+        </object>
+    </operation>
+</operations>

--- /dev/null
+++ b/Test/Mftf/Metadata/amazon_currency_config-meta.xml
@@ -0,0 +1,45 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<operations xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:DataGenerator/etc/dataOperation.xsd">
+    <operation name="AmazonCurrencyConfig" dataType="amazon_currency_config" type="create" auth="adminFormKey" url="/admin/system_config/save/section/currency/" method="POST">
+        <object key="groups" dataType="amazon_currency_config">
+            <object key="options" dataType="amazon_currency_config">
+                <object key="fields" dataType="amazon_currency_config">
+                    <object key="base" dataType="base">
+                        <field key="value">string</field>
+                    </object>
+                    <object key="default" dataType="default">
+                        <field key="value">string</field>
+                    </object>
+                    <object key="allow" dataType="allow">
+                        <array key="value">
+                            <value>string</value>
+                        </array>
+                    </object>
+                </object>
+            </object>
+        </object>
+    </operation>
+    <operation name="DefaultAmazonCurrencyConfig" dataType="default_amazon_currency_config" type="create" auth="adminFormKey" url="/admin/system_config/save/section/currency/" method="POST">
+        <object key="groups" dataType="default_amazon_currency_config">
+            <object key="options" dataType="default_amazon_currency_config">
+                <object key="fields" dataType="default_amazon_currency_config">
+                    <object key="base" dataType="default_amazon_currency_config">
+                        <object key="inherit" dataType="amazonCurrencyBaseFlagZero">
+                            <field key="value">integer</field>
+                        </object>
+                    </object>
+                    <object key="default" dataType="default_amazon_currency_config">
+                        <object key="inherit" dataType="amazonCurrencyDefaultFlagZero">
+                            <field key="value">integer</field>
+                        </object>
+                    </object>
+                    <object key="allow" dataType="default_amazon_currency_config">
+                        <object key="inherit" dataType="amazonCurrencyAllowFlagZero">
+                            <field key="value">integer</field>
+                        </object>
+                    </object>
+                </object>
+            </object>
+        </object>
+    </operation>
+</operations>

--- /dev/null
+++ b/Test/Mftf/Section/AmazonAddressSection.xml
@@ -0,0 +1,22 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+ /**
+  * Copyright Â© Magento, Inc. All rights reserved.
+  * See COPYING.txt for license details.
+  */
+-->
+
+<sections xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+        xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/sectionObjectSchema.xsd">
+    <!--Amazon New Address Widget-->
+    <section name="AmazonAddressSection">
+        <element name="country" type="select" selector="address-ui-widgets-countryCode-dropdown-nativeId"/>
+        <element name="name" type="input" selector="#address-ui-widgets-enterAddressFullName"/>
+        <element name="address" type="input" selector="#address-ui-widgets-enterAddressLine1"/>
+        <element name="city" type="input" selector="#address-ui-widgets-enterAddressCity"/>
+        <element name="region" type="input" selector="#address-ui-widgets-enterAddressStateOrRegion"/>
+        <element name="postal" type="input" selector="#address-ui-widgets-enterAddressPostalCode"/>
+        <element name="phone" type="input" selector="#address-ui-widgets-enterAddressPhoneNumber"/>
+        <element name="submit" type="button" selector="[type=submit]"/>
+    </section>
+</sections>

--- a/Test/Mftf/Section/AmazonCheckoutSection.xml
+++ b/Test/Mftf/Section/AmazonCheckoutSection.xml
@@ -14,5 +14,6 @@
         <element name="productPayButton" type="button" selector="#amazon-addtoCart-amazon-pay-button-product"/>
         <element name="checkoutPayButton" type="button" selector=".amazon-button-container img"/>
         <element name="loginButton" type="button" selector="#LoginWithAmazon-amazon-login img"/>
+        <element name="addNewAddress" type="block" selector=".footer .info a"/>
     </section>
 </sections>

--- a/Test/Mftf/Test/AmazonCheckoutDeclineTest.xml
+++ b/Test/Mftf/Test/AmazonCheckoutDeclineTest.xml
@@ -230,4 +230,51 @@
         <!--Transaction declined error message-->
         <waitForText userInput="There was a problem with your payment." selector=".message" stepKey="waitForText"/>
     </test>
+    <test name="AmazonCheckoutAddressFailure" extends="AmazonCheckoutAddProductDetail">
+        <annotations>
+            <stories value="Test new shipping address validation"/>
+            <title value="Amazon Pay Invalid Shipping Address"/>
+            <description value="Adds an invalid address to Amazon Address widget to test Magento shipping address validation"/>
+            <severity value="CRITICAL"/>
+            <group value="amazon_decline"/>
+        </annotations>
+
+        <before>
+            <createData entity="SimpleTwo" stepKey="createSimpleProduct"/>
+            <createData entity="SingleCountryAllowConfig" stepKey="SingleCountryAllowConfig"/>
+            <createData entity="SampleAmazonPaymentConfig" stepKey="SampleAmazonPaymentConfigData"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </before>
+
+        <after>
+            <createData entity="DefaultCountryAllowConfig" stepKey="DefaultCountryAllowConfig"/>
+            <createData entity="DefaultAmazonPaymentConfig" stepKey="DefaultAmazonPaymentConfig"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </after>
+
+        <!--Save opener window name since popup auto-closes-->
+        <executeJS function="return window.name;" stepKey="openerName"/>
+        <!--Get address widget iframe name (dynamic)-->
+        <executeJS function="return jQuery('#addressBookWidgetDiv iframe').attr('name');" stepKey="iframeName"/>
+        <switchToIFrame userInput="{$iframeName}" stepKey="switchToIFrameWidget"/>
+        <!--Open new address pop-up-->
+        <click selector="{{AmazonCheckoutSection.addNewAddress}}" stepKey="clickAddNew"/>
+        <waitForPageLoad stepKey="waitForPageLoadPopup"/>
+        <executeJS function="return document.getElementById('addShippingAddressForm').target;" stepKey="windowAddressName"/>
+        <switchToWindow userInput="{$windowAddressName}" stepKey="switchToWindowAddress"/>
+        <waitForElement selector="{{AmazonAddressSection.name}}" time="10" stepKey="apWait"/>
+        <!--Add new address-->
+        <!--Select is hidden, so must change with JS-->
+        <executeJS function="document.getElementById('{{AmazonAddressSection.country}}').value = '{{AmazonAddressFail.country}}'" stepKey="apcountry"/>
+        <fillField selector="{{AmazonAddressSection.name}}" userInput="{{AmazonAddressFail.name}}" stepKey="enterName"/>
+        <fillField selector="{{AmazonAddressSection.address}}" userInput="{{AmazonAddressFail.address}}" stepKey="enterAddress"/>
+        <fillField selector="{{AmazonAddressSection.city}}" userInput="{{AmazonAddressFail.city}}" stepKey="enterCity"/>
+        <fillField selector="{{AmazonAddressSection.region}}" userInput="{{AmazonAddressFail.region}}" stepKey="enterRegion"/>
+        <fillField selector="{{AmazonAddressSection.postal}}" userInput="{{AmazonAddressFail.postal}}" stepKey="enterPostal"/>
+        <fillField selector="{{AmazonAddressSection.phone}}" userInput="{{AmazonAddressFail.phone}}" stepKey="enterPhone"/>
+        <click selector="{{AmazonAddressSection.submit}}" stepKey="clickAddAddressButton"/>
+        <!--Switch back to Magento and detect error from new address-->
+        <switchToWindow userInput="{$openerName}" stepKey="switchToWindowOpener" />
+        <waitForText userInput="The country associated with your address is not allowed" selector=".message" stepKey="waitForText"/>
+    </test>
 </tests>

--- /dev/null
+++ b/Test/Mftf/Test/AmazonInvoiceTest.xml
@@ -0,0 +1,147 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<tests xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:mftf:Test/etc/testSchema.xsd">
+    <test name="AmazonMultiInvoice">
+        <annotations>
+            <stories value="Amazon Pay Invoice"/>
+            <title value="Admin user must be able to split invoices when configuration allows"/>
+            <description value="Admin user must be able to split invoices when configuration allows"/>
+            <severity value="CRITICAL"/>
+            <group value="amazon_invoice"/>
+        </annotations>
+
+        <before>
+            <createData entity="SimpleTwo" stepKey="createSimpleProduct1"/>
+            <createData entity="SimpleTwo" stepKey="createSimpleProduct2"/>
+            <createData entity="MultiInvoiceAmazonPaymentConfig" stepKey="MultiInvoiceAmazonPaymentConfig"/>
+            <createData entity="MultiInvoiceAmazonCurrencyConfig" stepKey="MultiInvoiceAmazonCurrencyConfig"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </before>
+
+        <after>
+            <createData entity="DefaultAmazonPaymentConfig" stepKey="DefaultAmazonPaymentConfig"/>
+            <createData entity="DefaultAmazonCurrencyConfig" stepKey="DefaultAmazonCurrencyConfig"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </after>
+
+        <!-- Go to product 1 page and add to cart -->
+        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProduct1StoreFront">
+            <argument name="productUrl" value="$$createSimpleProduct1.custom_attributes[url_key]$$"/>
+        </actionGroup>
+        <actionGroup ref="StorefrontAddToTheCartActionGroup" stepKey="addProduct1ToCart"/>
+
+        <!-- Go to product 2 page and add to cart -->
+        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProduct2StoreFront">
+            <argument name="productUrl" value="$$createSimpleProduct2.custom_attributes[url_key]$$"/>
+        </actionGroup>
+        <actionGroup ref="StorefrontAddToTheCartActionGroup" stepKey="addProduct2ToCart"/>
+
+        <!-- Click on mini cart -->
+        <actionGroup ref="StorefrontClickOnMiniCartActionGroup" stepKey="clickOnMiniCart"/>
+
+        <!-- Login (redirect) -->
+        <click selector="{{AmazonCheckoutSection.miniCartPayButton}}" stepKey="clickAmazonCartButton"/>
+        <actionGroup ref="AmazonLoginRedirectActionGroup" stepKey="AmazonLoginRedirectActionGroup" />
+
+        <!-- Place order -->
+        <actionGroup ref="AmazonCheckoutSubmitActionGroup" stepKey="AmazonCheckoutSubmitActionGroup" />
+        <grabTextFrom selector="{{CheckoutSuccessMainSection.orderNumber}}" stepKey="grabOrderNumber"/>
+
+        <!-- Login as admin -->
+        <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
+
+        <!-- Open created order in backend -->
+        <amOnPage url="{{AdminOrdersPage.url}}" stepKey="goToOrders"/>
+        <waitForPageLoad stepKey="waitForOrdersPageLoad"/>
+        <actionGroup ref="OpenOrderById" stepKey="filterOrderGridById">
+            <argument name="orderId" value="$grabOrderNumber"/>
+        </actionGroup>
+
+        <!-- Create Invoice 1 -->
+        <click selector="{{AdminOrderDetailsMainActionsSection.invoice}}" stepKey="clickInvoice1"/>
+        <waitForPageLoad stepKey="waitForInvoicePage1"/>
+        <fillField stepKey="fillQty" userInput="1" selector="{{AdminInvoiceItemsSection.itemQtyToInvoice('1')}}"/>
+        <fillField stepKey="fillNoQty" userInput="0" selector="{{AdminInvoiceItemsSection.itemQtyToInvoice('2')}}"/>
+        <click selector="{{AdminInvoiceItemsSection.updateQty}}" stepKey="updateQty"/>
+        <waitForPageLoad stepKey="waitPageToBeLoaded"/>
+        <click selector="{{AdminInvoiceMainActionsSection.submitInvoice}}" stepKey="submitInvoice1"/>
+        <waitForPageLoad stepKey="waitForLoadPage1"/>
+        <see userInput="The invoice has been created." stepKey="seeMessage1"/>
+
+        <!-- Create Invoice 2 -->
+        <click selector="{{AdminOrderDetailsMainActionsSection.invoice}}" stepKey="clickInvoice2"/>
+        <waitForPageLoad stepKey="waitForInvoicePage2"/>
+        <click selector="{{AdminInvoiceMainActionsSection.submitInvoice}}" stepKey="submitInvoice2"/>
+        <waitForPageLoad stepKey="waitForLoadPage2"/>
+        <see userInput="The invoice has been created." stepKey="seeMessage2"/>
+    </test>
+    <test name="AmazonSingleInvoice">
+        <annotations>
+            <stories value="Amazon Pay Invoice"/>
+            <title value="Admin user must be unable to split invoices when configuration disallows"/>
+            <description value="Admin user must be unable to split invoices when configuration disallows"/>
+            <severity value="CRITICAL"/>
+            <group value="amazon_invoice"/>
+        </annotations>
+
+        <before>
+            <createData entity="SimpleTwo" stepKey="createSimpleProduct1"/>
+            <createData entity="SimpleTwo" stepKey="createSimpleProduct2"/>
+            <createData entity="SingleInvoiceAmazonPaymentConfig" stepKey="SingleInvoiceAmazonPaymentConfig"/>
+            <createData entity="SingleInvoiceAmazonCurrencyConfig" stepKey="SingleInvoiceAmazonCurrencyConfig"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </before>
+
+        <after>
+            <createData entity="DefaultAmazonPaymentConfig" stepKey="DefaultAmazonPaymentConfig"/>
+            <createData entity="DefaultAmazonCurrencyConfig" stepKey="DefaultAmazonCurrencyConfig"/>
+            <magentoCLI command="cache:flush" stepKey="flushCache"/>
+        </after>
+
+        <!-- Go to product 1 page and add to cart -->
+        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProduct1StoreFront">
+            <argument name="productUrl" value="$$createSimpleProduct1.custom_attributes[url_key]$$"/>
+        </actionGroup>
+        <actionGroup ref="StorefrontAddToTheCartActionGroup" stepKey="addProduct1ToCart"/>
+
+        <!-- Go to product 2 page and add to cart -->
+        <actionGroup ref="StorefrontOpenProductPageActionGroup" stepKey="openProduct2StoreFront">
+            <argument name="productUrl" value="$$createSimpleProduct2.custom_attributes[url_key]$$"/>
+        </actionGroup>
+        <actionGroup ref="StorefrontAddToTheCartActionGroup" stepKey="addProduct2ToCart"/>
+
+        <!-- Click on mini cart -->
+        <actionGroup ref="StorefrontClickOnMiniCartActionGroup" stepKey="clickOnMiniCart"/>
+
+        <!-- Login (redirect) -->
+        <click selector="{{AmazonCheckoutSection.miniCartPayButton}}" stepKey="clickAmazonCartButton"/>
+        <actionGroup ref="AmazonLoginRedirectActionGroup" stepKey="AmazonLoginRedirectActionGroup" />
+
+        <!-- Place order -->
+        <actionGroup ref="AmazonCheckoutSubmitActionGroup" stepKey="AmazonCheckoutSubmitActionGroup" />
+        <grabTextFrom selector="{{CheckoutSuccessMainSection.orderNumber}}" stepKey="grabOrderNumber"/>
+
+        <!-- Login as admin -->
+        <actionGroup ref="LoginAsAdmin" stepKey="loginAsAdmin"/>
+
+        <!-- Open created order in backend -->
+        <amOnPage url="{{AdminOrdersPage.url}}" stepKey="goToOrders"/>
+        <waitForPageLoad stepKey="waitForOrdersPageLoad"/>
+        <actionGroup ref="OpenOrderById" stepKey="filterOrderGridById">
+            <argument name="orderId" value="$grabOrderNumber"/>
+        </actionGroup>
+
+        <!-- Create Invoice -->
+        <click selector="{{AdminOrderDetailsMainActionsSection.invoice}}" stepKey="clickInvoice"/>
+        <waitForPageLoad stepKey="waitForInvoicePage"/>
+
+        <!-- Verify invoice item qtys cannot be changed -->
+        <dontSeeElement stepKey="dontSeeItemQtyToInvoice1" selector="{{AdminInvoiceItemsSection.itemQtyToInvoice('1')}}"/>
+        <dontSeeElement stepKey="dontSeeItemQtyToInvoice2" selector="{{AdminInvoiceItemsSection.itemQtyToInvoice('2')}}"/>
+        <dontSeeElement stepKey="dontSeeUpdateQty" selector="{{AdminInvoiceItemsSection.updateQty}}"/>
+
+        <!-- Submit and verify the invoice created -->
+        <click selector="{{AdminInvoiceMainActionsSection.submitInvoice}}" stepKey="submitInvoice"/>
+        <waitForPageLoad stepKey="waitForLoadPage"/>
+        <see userInput="The invoice has been created." stepKey="seeMessage"/>
+    </test>
+</tests>

--- a/composer.json
+++ b/composer.json
@@ -2,14 +2,14 @@
   "name": "amzn/amazon-pay-module",
   "description": "Amazon Pay module",
   "type": "magento2-module",
-  "version": "3.3.1",
+  "version": "3.5.2",
   "license": [
     "Apache-2.0"
   ],
   "require": {
     "php": "~7.1.3||~7.2.0||~7.3.0",
-    "amzn/amazon-pay-and-login-with-amazon-core-module": "^3.3.1",
-    "amzn/login-with-amazon-module": "^3.3.1",
+    "amzn/amazon-pay-and-login-with-amazon-core-module": "^3.5.2",
+    "amzn/login-with-amazon-module": "^3.5.2",
     "magento/framework": "^102",
     "magento/module-customer": "^102",
     "magento/module-eav": "^102",

--- /dev/null
+++ b/etc/csp_whitelist.xml
@@ -0,0 +1,110 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<csp_whitelist xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:module:Magento_Csp:etc/csp_whitelist.xsd">
+    <policies>
+        <policy id="connect-src">
+            <values>
+                <value id="amazon_com" type="host">*.amazon.com</value>
+                <value id="amazon_co_uk" type="host">*.amazon.co.uk</value>
+                <value id="amazon_co_jp" type="host">*.amazon.co.jp</value>
+                <value id="amazon_jp" type="host">*.amazon.jp</value>
+                <value id="amazon_it" type="host">*.amazon.it</value>
+                <value id="amazon_fr" type="host">*.amazon.fr</value>
+                <value id="amazon_es" type="host">*.amazon.es</value>
+                <value id="amazonpay_com" type="host">*.amazonpay.com</value>
+                <value id="amazonpay_co_uk" type="host">*.amazonpay.co.uk</value>
+                <value id="amazonpay_co_jp" type="host">*.amazonpay.co.jp</value>
+                <value id="amazonpay_jp" type="host">*.amazonpay.jp</value>
+                <value id="amazonpay_it" type="host">*.amazonpay.it</value>
+                <value id="amazonpay_fr" type="host">*.amazonpay.fr</value>
+                <value id="amazonpay_es" type="host">*.amazonpay.es</value>
+                <value id="amazonservices_com" type="host">mws.amazonservices.com</value>
+                <value id="amazonservices_co_uk" type="host">mws.amazonservices.co.uk</value>
+                <value id="amazonservices_co_jp" type="host">mws.amazonservices.co.jp</value>
+                <value id="amazonservices_jp" type="host">mws.amazonservices.jp</value>
+                <value id="amazonservices_it" type="host">mws.amazonservices.it</value>
+                <value id="amazonservices_fr" type="host">mws.amazonservices.fr</value>
+                <value id="amazonservices_es" type="host">mws.amazonservices.es</value>
+            </values>
+        </policy>
+        <policy id="script-src">
+            <values>
+                <value id="amazon_payment_widget_com" type="host">*.payments-amazon.com</value>
+                <value id="amazon_payment_widget_co_uk" type="host">*.payments-amazon.co.uk</value>
+                <value id="amazon_payment_widget_co_jp" type="host">*.payments-amazon.co.jp</value>
+                <value id="amazon_payment_widget_jp" type="host">*.payments-amazon.jp</value>
+                <value id="amazon_payment_widget_it" type="host">*.payments-amazon.it</value>
+                <value id="amazon_payment_widget_fr" type="host">*.payments-amazon.fr</value>
+                <value id="amazon_payment_widget_es" type="host">*.payments-amazon.es</value>
+            </values>
+        </policy>
+        <policy id="img-src">
+            <values>
+                <value id="amazon_cloudfront01" type="host">d3sbl0c71oxeok.cloudfront.net</value>
+                <value id="amazon_cloudfront02" type="host">dhkkzdfmpzvap.cloudfront.net</value>
+                <value id="amazon_cloudfront03" type="host">d2bpzs5y44q6e0.cloudfront.net</value>
+                <value id="amazon_cloudfront04" type="host">d37shgu97oizpd.cloudfront.net</value>
+                <value id="amazon_cloudfront05" type="host">d1zlqll3enr74n.cloudfront.net</value>
+                <value id="amazon_cloudfront06" type="host">d1jynp0fpwn93a.cloudfront.net</value>
+                <value id="amazon_cloudfront07" type="host">d2cb3tokgpwh3v.cloudfront.net</value>
+                <value id="amazon_cloudfront08" type="host">d1re8bfxx3pw6e.cloudfront.net</value>
+                <value id="amazon_cloudfront09" type="host">d35u8xwkxs8vpe.cloudfront.net</value>
+                <value id="amazon_cloudfront10" type="host">d13s9xffygp5o.cloudfront.net</value>
+                <value id="amazon_cloudfront11" type="host">d388nbw0dwi1jm.cloudfront.net</value>
+                <value id="amazon_cloudfront12" type="host">d11p2vtu3dppaw.cloudfront.net</value>
+                <value id="amazon_cloudfront13" type="host">d3r89hiip86hka.cloudfront.net</value>
+                <value id="amazon_cloudfront14" type="host">dc7snq0c8ipyk.cloudfront.net</value>
+                <value id="amazon_cloudfront15" type="host">d5c7kvljggzso.cloudfront.net</value>
+                <value id="amazon_cloudfront16" type="host">d2h8yg3ypfzua1.cloudfront.net</value>
+                <value id="amazon_cloudfront17" type="host">d1b556x7apj5fb.cloudfront.net</value>
+                <value id="amazon_cloudfront18" type="host">draz1ib3z71v2.cloudfront.net</value>
+                <value id="amazon_cloudfront19" type="host">dr6hdp4s5yzfc.cloudfront.net</value>
+                <value id="amazon_cloudfront20" type="host">d2bomicxw8p7ii.cloudfront.net</value>
+                <value id="amazon_cloudfront21" type="host">d3aypcdgvjnnam.cloudfront.net</value>
+                <value id="amazon_cloudfront22" type="host">d2a3iuf10348gy.cloudfront.net</value>
+                <value id="ssl_images_amazon_com" type="host">*.ssl-images-amazon.com</value>
+                <value id="ssl_images_amazon_co_uk" type="host">*.ssl-images-amazon.co.uk</value>
+                <value id="ssl_images_amazon_co_jp" type="host">*.ssl-images-amazon.co.jp</value>
+                <value id="ssl_images_amazon_jp" type="host">*.ssl-images-amazon.jp</value>
+                <value id="ssl_images_amazon_it" type="host">*.ssl-images-amazon.it</value>
+                <value id="ssl_images_amazon_fr" type="host">*.ssl-images-amazon.fr</value>
+                <value id="ssl_images_amazon_es" type="host">*.ssl-images-amazon.es</value>
+                <value id="media_amazon_com" type="host">*.media-amazon.com</value>
+                <value id="media_amazon_co_uk" type="host">*.media-amazon.co.uk</value>
+                <value id="media_amazon_co_jp" type="host">*.media-amazon.co.jp</value>
+                <value id="media_amazon_jp" type="host">*.media-amazon.jp</value>
+                <value id="media_amazon_it" type="host">*.media-amazon.it</value>
+                <value id="media_amazon_fr" type="host">*.media-amazon.fr</value>
+                <value id="media_amazon_es" type="host">*.media-amazon.es</value>
+            </values>
+        </policy>
+        <policy id="form-action">
+            <values>
+                <value id="amazon_com" type="host">*.amazon.com</value>
+                <value id="amazon_co_uk" type="host">*.amazon.co.uk</value>
+                <value id="amazon_co_jp" type="host">*.amazon.co.jp</value>
+                <value id="amazon_jp" type="host">*.amazon.jp</value>
+                <value id="amazon_it" type="host">*.amazon.it</value>
+                <value id="amazon_fr" type="host">*.amazon.fr</value>
+                <value id="amazon_es" type="host">*.amazon.es</value>
+            </values>
+        </policy>
+        <policy id="frame-src">
+            <values>
+                <value id="amazon_com" type="host">*.amazon.com</value>
+                <value id="amazon_co_uk" type="host">*.amazon.co.uk</value>
+                <value id="amazon_co_jp" type="host">*.amazon.co.jp</value>
+                <value id="amazon_jp" type="host">*.amazon.jp</value>
+                <value id="amazon_it" type="host">*.amazon.it</value>
+                <value id="amazon_fr" type="host">*.amazon.fr</value>
+                <value id="amazon_es" type="host">*.amazon.es</value>
+                <value id="amazon_payment_widget_com" type="host">*.payments-amazon.com</value>
+                <value id="amazon_payment_widget_co_uk" type="host">*.payments-amazon.co.uk</value>
+                <value id="amazon_payment_widget_co_jp" type="host">*.payments-amazon.co.jp</value>
+                <value id="amazon_payment_widget_jp" type="host">*.payments-amazon.jp</value>
+                <value id="amazon_payment_widget_it" type="host">*.payments-amazon.it</value>
+                <value id="amazon_payment_widget_fr" type="host">*.payments-amazon.fr</value>
+                <value id="amazon_payment_widget_es" type="host">*.payments-amazon.es</value>
+            </values>
+        </policy>
+    </policies>
+</csp_whitelist>

--- a/etc/di.xml
+++ b/etc/di.xml
@@ -95,9 +95,6 @@
 
     <!-- Configuration reader -->
     <virtualType name="AmazonGatewayConfig" type="Amazon\Payment\Gateway\Config\Config">
-        <arguments>
-            <argument name="methodCode" xsi:type="const">Amazon\Payment\Gateway\Config\Config::CODE</argument>
-        </arguments>
     </virtualType>
 
     <virtualType name="AmazonCommandManager" type="Magento\Payment\Gateway\Command\CommandManager">

--- a/etc/module.xml
+++ b/etc/module.xml
@@ -16,7 +16,7 @@
  */
 -->
 <config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:Module/etc/module.xsd">
-    <module name="Amazon_Payment" setup_version="3.3.1" >
+    <module name="Amazon_Payment" setup_version="3.5.2" >
         <sequence>
             <module name="Amazon_Core"/>
             <module name="Amazon_Login"/>

--- a/i18n/de_AT.csv
+++ b/i18n/de_AT.csv
@@ -20,3 +20,5 @@
 "Your session has expired, please reload the page and try again.","Ihre Sitzung ist abgelaufen. Bitte laden Sie die Seite erneut und versuchen Sie es noch einmal."
 "Return to standard checkout","Zum Standard Checkout zurÃ¼ckkehren"
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Mit dieser Zahlungsart ist ein Problem aufgetreten. Um Ihre Bestellung abzuschlieÃen, wÃ¤hlen Sie bitte eine andere aus."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Ihre Zahlung mit Amazon Pay ist derzeit noch in Prufung. Bitte beachten Sie, dass wir uns mit Ihnen in Kurze per Email in Verbindung setzen werden, falls noch Unklarheiten bestehen sollten."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Fall Sie ihr Passwort zurÃ¼cksetzen mÃ¶chten, <a href=""%1"">loggen Sie sich bitte aus</a> und klicken Sie auf der Anmeldeseite auf âPasswort vergessenâ"

--- a/i18n/de_CH.csv
+++ b/i18n/de_CH.csv
@@ -20,3 +20,5 @@
 "Your session has expired, please reload the page and try again.","Ihre Sitzung ist abgelaufen. Bitte laden Sie die Seite erneut und versuchen Sie es noch einmal."
 "Return to standard checkout","Zum Standard Checkout zurÃ¼ckkehren"
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Mit dieser Zahlungsart ist ein Problem aufgetreten. Um Ihre Bestellung abzuschlieÃen, wÃ¤hlen Sie bitte eine andere aus."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Ihre Zahlung mit Amazon Pay ist derzeit noch in Prufung. Bitte beachten Sie, dass wir uns mit Ihnen in Kurze per Email in Verbindung setzen werden, falls noch Unklarheiten bestehen sollten."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Fall Sie ihr Passwort zurÃ¼cksetzen mÃ¶chten, <a href=""%1"">loggen Sie sich bitte aus</a> und klicken Sie auf der Anmeldeseite auf âPasswort vergessenâ"

--- a/i18n/de_DE.csv
+++ b/i18n/de_DE.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Zum Standard Checkout zurÃ¼ckkehren"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Beim Zahlungsvorgang ist ein Problem aufgetreten. Ihre Bestellung wurde nicht aufgegeben und Ihr Konto nicht belastet."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Mit dieser Zahlungsart ist ein Problem aufgetreten. Um Ihre Bestellung abzuschlieÃen, wÃ¤hlen Sie bitte eine andere aus."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Ihre Zahlung mit Amazon Pay ist derzeit noch in Prufung. Bitte beachten Sie, dass wir uns mit Ihnen in Kurze per Email in Verbindung setzen werden, falls noch Unklarheiten bestehen sollten."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Fall Sie ihr Passwort zurÃ¼cksetzen mÃ¶chten, <a href=""%1"">loggen Sie sich bitte aus</a> und klicken Sie auf der Anmeldeseite auf âPasswort vergessenâ"

--- a/i18n/en_GB.csv
+++ b/i18n/en_GB.csv
@@ -18,3 +18,5 @@
 "Please select a payment method.","Please select a payment method."
 "Your session has expired, please reload the page and try again.","Your session has expired, please reload the page and try again."
 "Return to standard checkout","Return to standard checkout"
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page"

--- a/i18n/en_US.csv
+++ b/i18n/en_US.csv
@@ -118,3 +118,5 @@
 "Your session has expired, please reload the page and try again.","Your session has expired, please reload the page and try again."
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","There was a problem with your payment. Your order hasn't been placed, and you haven't been charged."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Something's wrong with your payment method. To place your order, try another."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page"

--- a/i18n/es_AR.csv
+++ b/i18n/es_AR.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_CL.csv
+++ b/i18n/es_CL.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_CO.csv
+++ b/i18n/es_CO.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_CR.csv
+++ b/i18n/es_CR.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_ES.csv
+++ b/i18n/es_ES.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_MX.csv
+++ b/i18n/es_MX.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_PA.csv
+++ b/i18n/es_PA.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_PE.csv
+++ b/i18n/es_PE.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/es_VE.csv
+++ b/i18n/es_VE.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Vuelva a su checkout estÃ¡ndar"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Se ha producido un problema con el pago. Tu pedido no se ha confirmado y no se te ha cargado ningÃºn importe."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Se ha producido un error con tu mÃ©todo de pago. Para confirmar tu pedido, prueba con otro mÃ©todo de pago."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Tu transaccion con Amazon Pay se esta verificando. Te informaremos tan pronto como sea posible."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Para restablecer tu contraseÃ±a, <a href=""%1"">cierra la sesiÃ³n</a> y pulsa âÂ¿Has olvidado tu contraseÃ±a?â en la pagina de acceso."

--- a/i18n/fr_CA.csv
+++ b/i18n/fr_CA.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Revenir Ã  la commande standard"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Un problÃ¨me sâest produit avec votre paiement. Votre commande n'a pas Ã©tÃ© passÃ©e et vous n'avez pas Ã©tÃ© dÃ©bitÃ©."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Un problÃ¨me est survenu avec votre moyen de paiement. Pour passer votre commande, essayez un autre moyen de paiement."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Votre transaction avec Amazon Pay est en cours de validation. Vous serez informe prochainement de son suivi."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Pour rÃ©initialiser votre mot de passe, veuillez-vous <a href=""%1"">DÃ©connexion</a> et cliquer sur âMot de passe oubliÃ©?â depuis la page de connexion"

--- a/i18n/fr_FR.csv
+++ b/i18n/fr_FR.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Revenir Ã  la commande standard"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Un problÃ¨me sâest produit avec votre paiement. Votre commande n'a pas Ã©tÃ© passÃ©e et vous n'avez pas Ã©tÃ© dÃ©bitÃ©."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Un problÃ¨me est survenu avec votre moyen de paiement. Pour passer votre commande, essayez un autre moyen de paiement."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","Votre transaction avec Amazon Pay est en cours de validation. Vous serez informe prochainement de son suivi."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Pour rÃ©initialiser votre mot de passe, veuillez-vous <a href=""%1"">DÃ©connexion</a> et cliquer sur âMot de passe oubliÃ©?â depuis la page de connexion"

--- a/i18n/it_CH.csv
+++ b/i18n/it_CH.csv
@@ -20,3 +20,5 @@
 "Your session has expired, please reload the page and try again.","La sessione Ã¨ scaduta. Ricarica la pagina e riprova."
 "Return to standard checkout","Ritorna al tuo checkout originale"
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Si Ã¨ verificato un problema con il metodo di pagamento. Per effettuare l'ordine, prova con un altro metodo di pagamento."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","La vostra transazione con Amazon Pay e in fase di validazione. Vi informeremo del risultato della transazione a breve."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Per resettare la tua password, per favore <a href=""%1"">Esci</a> dal tuo account e seleziona âHai dimenticato la password?" dalla pagina di Accesso"

--- a/i18n/it_IT.csv
+++ b/i18n/it_IT.csv
@@ -21,3 +21,5 @@
 "Return to standard checkout","Ritorna al tuo checkout originale"
 "Amazon Pay was unable to authenticate the payment instrument.  Please try again, or use a different payment method.","Si Ã¨ verificato un problema con il pagamento. L'ordine non Ã¨ stato effettuato, pertanto non ti Ã¨ stato addebitato alcun importo."
 "The SCA challenge was not completed successfully.  Please try again, or use a different payment method.","Si Ã¨ verificato un problema con il metodo di pagamento. Per effettuare l'ordine, prova con un altro metodo di pagamento."
+"Your transaction with Amazon Pay is currently being validated. Please be aware that we will inform you shortly as needed.","La vostra transazione con Amazon Pay e in fase di validazione. Vi informeremo del risultato della transazione a breve."
+"In order to reset your password, please <a href=""%1"">Sign Out</a> and click on âForgot Your Password?â from the Sign In page","Per resettare la tua password, per favore <a href=""%1"">Esci</a> dal tuo account e seleziona âHai dimenticato la password?" dalla pagina di Accesso"

--- a/view/frontend/layout/checkout_index_index.xml
+++ b/view/frontend/layout/checkout_index_index.xml
@@ -15,7 +15,7 @@
  * permissions and limitations under the License.
  */
 -->
-<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" layout="checkout" xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">
+<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">
     <body>
         <referenceBlock name="minicart">
             <arguments>
@@ -45,8 +45,20 @@
                                         <item name="shipping-step" xsi:type="array">
                                             <item name="children" xsi:type="array">
                                                 <item name="shippingAddress" xsi:type="array">
+                                                    <item name="component" xsi:type="string">Amazon_Payment/js/view/shipping</item>
                                                     <item name="children" xsi:type="array">
+                                                        <item name="address-list" xsi:type="array">
+                                                            <item name="component" xsi:type="string">Amazon_Payment/js/view/shipping-address/list</item>
+                                                        </item>
+                                                        <item name="shipping-address-fieldset" xsi:type="array">
+                                                            <item name="children" xsi:type="array">
+                                                                <item name="inline-form-manipulator" xsi:type="array">
+                                                                    <item name="component" xsi:type="string">Amazon_Payment/js/view/shipping-address/inline-form</item>
+                                                                </item>
+                                                            </item>
+                                                        </item>
                                                         <item name="customer-email" xsi:type="array">
+                                                            <item name="component" xsi:type="string">Amazon_Payment/js/view/form/element/email</item>
                                                             <item name="children" xsi:type="array">
                                                                 <item name="amazon-button-region" xsi:type="array">
                                                                     <item name="component" xsi:type="string">uiComponent</item>

--- a/view/frontend/templates/minicart-button.phtml
+++ b/view/frontend/templates/minicart-button.phtml
@@ -24,6 +24,10 @@ $jsonHelper = $this->helper(Magento\Framework\Json\Helper\Data::class);
 ?>
 
 <div id="minicart-amazon-pay-button" class="amazon-minicart-container">
+    <div class="amazon-divider">
+        <span><?= __('or') ?></span>
+    </div>
+
     <div class="amazon-button-container">
         <div class="amazon-button-container__cell">
             <div id="PayWithAmazon-<?= /* @noEscape */ $block->getParentBlock()->getJsId() ?>"

--- a/view/frontend/templates/payment-link-product-page.phtml
+++ b/view/frontend/templates/payment-link-product-page.phtml
@@ -15,7 +15,10 @@
  */
 ?>
 <?php /** @var \Amazon\Payment\Block\ProductPagePaymentLink $block */ ?>
+<div class="amazon-checkout-now"><?= __('Checkout now') ?></div>
+
 <div class="amazon-button-container centered-button">
+
     <div class="amazon-button-container__cell">
         <a href="javascript:;"
            class="amazon-addtoCart"

--- a/view/frontend/templates/widget/resetpassword.phtml
+++ b/view/frontend/templates/widget/resetpassword.phtml
@@ -6,9 +6,11 @@
 
 // @codingStandardsIgnoreFile
 
-/** @var \Magento\Customer\Block\Widget\Company $block */
+/** @var \Amazon\Payment\Block\Widget\ResetPassword $block */
 ?>
 <div class="field password-info">
-    <p><?= $block->escapeHtml(__('If you created this account using Amazon Pay, you might not know your site password.')) ?>
-        <a href="<?= $block->escapeHtml($block->getLink()); ?>"><?= $block->escapeHtml(__('Request a password to change your account password.')); ?></a></p>
+    <p>
+        <?= $block->escapeHtml(__('If you created this account using Amazon Pay, you might not know your site password.')) ?><br />
+        <?= __('In order to reset your password, please <a href="%1">Sign Out</a> and click on âForgot Your Password?â from the Sign In page', $block->getLink()) ?>
+    </p>
 </div>

--- a/view/frontend/web/css/source/_module.less
+++ b/view/frontend/web/css/source/_module.less
@@ -15,6 +15,18 @@
 
 & when (@media-common = true) {
 
+    .amazon-divider {
+        border-bottom: 1px solid #cccccc;
+        line-height: 0.1em;
+        margin: 18px 0 20px;
+        text-align: center;
+        max-width: 500px;
+        span {
+            background: #fff;
+            padding:0 5px;
+        }
+    }
+
     /** mini cart styling **/
     .product-social-links,
     .amazon-minicart-container {
@@ -23,9 +35,8 @@
         text-align: center;
         .amazon-button-container {
             display: inline-block;
-            margin: 12px 0 4px 0;
+            margin: 0px;
         }
-
         .field-tooltip {
             .field-tooltip-content {
                 top: 38px;
@@ -50,7 +61,17 @@
             }
         }
     }
-
+    .product-social-links {
+        .amazon-button-container {
+            margin-bottom: 30px;
+            display: block;
+        }
+    }
+    .amazon-checkout-now {
+        border-top: 1px solid #c1c1c1;
+        padding-top: 10px;
+        margin-bottom: 10px;
+    }
     .amazon-addtoCart {
         display: block;
         width: 100%;
@@ -90,7 +111,11 @@
     }
 
     .checkout-methods-items {
-
+        .amazon-minicart-container {
+            .amazon-divider {
+                display: none;
+            }
+        }
         .centered-button {
             margin-bottom: 0;
 
@@ -137,6 +162,12 @@
         }
     }
 
+    #checkout-step-shipping {
+        .amazon-divider {
+            margin: 40px 0;
+        }
+    }
+
     .checkout-payment-method {
         .amazon-payment-method {
             .payment-method-title {

--- a/view/frontend/web/js/action/place-order.js
+++ b/view/frontend/web/js/action/place-order.js
@@ -23,9 +23,10 @@ define(
         'Magento_Customer/js/model/customer',
         'Magento_Checkout/js/model/full-screen-loader',
         'Amazon_Payment/js/model/storage',
-        'Amazon_Payment/js/model/amazonPaymentConfig'
+        'Amazon_Payment/js/model/amazonPaymentConfig',
+        'Magento_Customer/js/customer-data'
     ],
-    function (quote, urlBuilder, storage, url, errorProcessor, customer, fullScreenLoader, amazonStorage, amazonPaymentConfig) {
+    function (quote, urlBuilder, storage, url, errorProcessor, customer, fullScreenLoader, amazonStorage, amazonPaymentConfig, customerData) {
         'use strict';
 
         return function (paymentData, redirectOnSuccess) {
@@ -39,6 +40,7 @@ define(
                     quoteId: quote.getQuoteId()
                 });
                 payload = {
+                    confirmOrder: true,
                     cartId: quote.getQuoteId(),
                     email: quote.guestEmail,
                     paymentMethod: paymentData,
@@ -47,6 +49,7 @@ define(
             } else {
                 serviceUrl = urlBuilder.createUrl('/carts/mine/set-payment-information', {});
                 payload = {
+                    confirmOrder: true,
                     cartId: quote.getQuoteId(),
                     paymentMethod: paymentData,
                     billingAddress: quote.billingAddress()
@@ -54,6 +57,7 @@ define(
             }
 
             fullScreenLoader.startLoader();
+            customerData.invalidate(['cart']);
             if(amazonPaymentConfig.getValue('scaRegions').indexOf(amazonPaymentConfig.getValue('region')) !== -1) {
                 console.log('SCA enabled for region: ' + amazonPaymentConfig.getValue('region'));
                 return OffAmazonPayments.initConfirmationFlow(amazonPaymentConfig.getValue('merchantId'), amazonStorage.getOrderReference(), function(confirmationFlow) {

--- a/view/frontend/web/js/amazon-button.js
+++ b/view/frontend/web/js/amazon-button.js
@@ -21,7 +21,6 @@ define([
     'Magento_Checkout/js/model/full-screen-loader',
     'modernizr/modernizr',
     'amazonCore',
-    'jquery/ui',
     'uiRegistry',
     'mage/cookies'
 ], function ($, customerData, sectionConfig, amazonPaymentConfig, amazonCsrf, fullScreenLoader) {

--- a/view/frontend/web/js/amazon-product-add.js
+++ b/view/frontend/web/js/amazon-product-add.js
@@ -16,8 +16,7 @@
 define([
     'jquery',
     'Magento_Customer/js/customer-data',
-    'amazonCore',
-    'jquery/ui'
+    'amazonCore'
 ], function ($, customerData) {
     'use strict';
 

--- /dev/null
+++ b/view/frontend/web/js/messages.js
@@ -0,0 +1,50 @@
+/**
+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License").
+ * You may not use this file except in compliance with the License.
+ * A copy of the License is located at
+ *
+ *  http://aws.amazon.com/apache2.0
+ *
+ * or in the "license" file accompanying this file. This file is distributed
+ * on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either
+ * express or implied. See the License for the specific language governing
+ * permissions and limitations under the License.
+ */
+
+define(
+    [
+        'jquery',
+        'Amazon_Payment/js/model/storage',
+        'Magento_Theme/js/view/messages',
+        'Magento_Ui/js/model/messageList'
+    ], function(
+        $,
+        amazonStorage,
+        messagesFactory,
+        messageList
+    ) {
+        'use strict';
+
+        return {
+            defaults: {},
+            isAmazonAccountLoggedIn: amazonStorage.isAmazonAccountLoggedIn,
+
+            /*
+             * Magento's core Checkout module removes the "messages" block from the layout,
+             *  so we display them on checkout using the messageList API.
+             */
+            displayMessages: function () {
+                if(this.isAmazonAccountLoggedIn()) {
+                    var messagesComponent = messagesFactory();
+                    messagesComponent.cookieMessages.forEach(function(message) {
+                        if(message.type == 'error') {
+                            messageList.addErrorMessage({message: $.mage.__($("<textarea/>").html(message.text).text())});
+                        }
+                    });
+                }
+            }
+        }
+    }
+);

--- a/view/frontend/web/js/model/storage.js
+++ b/view/frontend/web/js/model/storage.js
@@ -30,6 +30,7 @@ define(
 
         var isAmazonAccountLoggedIn = ko.observable(false),
             isAmazonEnabled = ko.observable(amazonPaymentConfig.getValue('isPwaEnabled')),
+            orderReferenceId = ko.observable(amazonPaymentConfig.getValue('orderReferenceId')),
             orderReference,
             addressConsentToken = amazonCore.accessToken,
             //eslint-disable-next-line no-use-before-define
@@ -49,7 +50,8 @@ define(
             isLoginRedirectPage = $('body').hasClass('amazon-login-login-processauthhash'),
             amazonCustomerEmail = ko.computed(function () {
                 // jscs:disable requireCamelCaseOrUpperCaseIdentifiers
-                if (window.checkoutConfig.hasOwnProperty('amazonLogin') &&
+                if (window.hasOwnProperty('checkoutConfig') &&
+                    window.checkoutConfig.hasOwnProperty('amazonLogin') &&
                     typeof window.checkoutConfig.amazonLogin.amazon_customer_email === 'string'
                 ) {
                     return window.checkoutConfig.amazonLogin.amazon_customer_email;
@@ -98,6 +100,7 @@ define(
         return {
             isAmazonAccountLoggedIn: isAmazonAccountLoggedIn,
             isAmazonEnabled: isAmazonEnabled,
+            orderReferenceId: orderReferenceId,
             amazonDeclineCode: amazonDeclineCode,
             sandboxSimulationReference: sandboxSimulationReference,
             isPlaceOrderDisabled: isPlaceOrderDisabled,
@@ -120,7 +123,7 @@ define(
              * Get order reference
              */
             getOrderReference: function () {
-                return orderReference;
+                return this.orderReferenceId() || orderReference;
             },
 
             /**

--- a/view/frontend/web/js/view/checkout-widget-address.js
+++ b/view/frontend/web/js/view/checkout-widget-address.js
@@ -20,7 +20,8 @@ define(
         'Magento_Checkout/js/model/url-builder',
         'Magento_Checkout/js/checkout-data',
         'Magento_Checkout/js/model/checkout-data-resolver',
-        'uiRegistry'
+        'uiRegistry',
+        'Amazon_Payment/js/messages'
     ],
     function (
         $,
@@ -41,7 +42,8 @@ define(
         urlBuilder,
         checkoutData,
         checkoutDataResolver,
-        registry
+        registry,
+        amazonMessages
     ) {
         'use strict';
 
@@ -68,6 +70,10 @@ define(
             initialize: function () {
                 self = this;
                 this._super();
+                // Update checkoutUrl for step-navigator if orderReferenceId is set (e.g. InvaldPaymentMethod)
+                if (amazonStorage.orderReferenceId()) {
+                    window.checkoutConfig.checkoutUrl += '?orderReferenceId=' + amazonStorage.orderReferenceId()
+                }
             },
 
             /**
@@ -98,8 +104,7 @@ define(
                      * Order reference creation callback
                      */
                     onOrderReferenceCreate: function (orderReference) {
-                        var orderid = orderReference.getAmazonOrderReferenceId();
-
+                        var orderid = amazonStorage.orderReferenceId() || orderReference.getAmazonOrderReferenceId();
                         amazonStorage.setOrderReference(orderid);
                     },
 
@@ -109,6 +114,7 @@ define(
                     onAddressSelect: function () { // orderReference
                         self.getShippingAddressFromAmazon();
                     },
+                    displayMode: self.isShippingAddressReadOnly() ? 'Read' : '',
                     design: {
                         designMode: 'responsive'
                     },
@@ -118,6 +124,7 @@ define(
                      */
                     onError: amazonCore.handleWidgetError
                 }).bind(self.options.addressWidgetDOMId);
+                amazonMessages.displayMessages();
             },
 
             /**
@@ -164,6 +171,10 @@ define(
                         //remove shipping loader and set shipping rates to 0 on a fail
                         shippingService.setShippingRates([]);
                         amazonStorage.isShippingMethodsLoading(false);
+                        if (self.isShippingAddressReadOnly()) {
+                            shippingService.isLoading(false);
+                            $('.checkout-shipping-method').hide();
+                        }
                     }
                 );
             },
@@ -180,6 +191,20 @@ define(
              */
             getAddressConsentToken: function () {
                 return amazonStorage.getAddressConsentToken();
+            },
+
+            /**
+             * Is shipping widget set to read-only (orderReferenceId already set?)
+             */
+            isShippingAddressReadOnly: function() {
+                return (amazonStorage.orderReferenceId());
+            },
+
+            /**
+             * Continue to payment (e.g. if shipping address is read-only)
+             */
+            continuePayment: function() {
+                window.location = window.checkoutConfig.checkoutUrl + '#payment';
             }
         });
     }

--- a/view/frontend/web/js/view/payment/method-renderer/amazon-payment-widget.js
+++ b/view/frontend/web/js/view/payment/method-renderer/amazon-payment-widget.js
@@ -18,7 +18,8 @@ define(
         'Magento_Checkout/js/model/payment/additional-validators',
         'Magento_Checkout/js/model/url-builder',
         'amazonPaymentConfig',
-        'uiRegistry'
+        'uiRegistry',
+        'Amazon_Payment/js/messages'
     ],
     function (
         $,
@@ -39,7 +40,8 @@ define(
         additionalValidators,
         urlBuilder,
         amazonPaymentConfig,
-        registry
+        registry,
+        amazonMessages
     ) {
         'use strict';
 
@@ -124,6 +126,7 @@ define(
                     $(this.presentmentDOMId).show();
                 }
                 widget.bind(this.paymentWidgetDOMId);
+                amazonMessages.displayMessages();
             },
 
             /**

--- a/view/frontend/web/js/view/shipping.js
+++ b/view/frontend/web/js/view/shipping.js
@@ -52,28 +52,16 @@ define(
              * New setShipping Action for Amazon Pay to bypass validation
              */
             setShippingInformation: function () {
-
-                /**
-                 * Set Amazon shipping info
-                 */
-                function setShippingInformationAmazon() {
-                    setShippingInformationAction().done(
-                        function () {
-                            stepNavigator.next();
-                        }
-                    );
-                }
-
-                if (amazonStorage.isAmazonAccountLoggedIn() && customer.isLoggedIn()) {
-                    setShippingInformationAmazon();
-                } else if (amazonStorage.isAmazonAccountLoggedIn() && !customer.isLoggedIn()) {
-
-                    if (this.validateGuestEmail()) {
-                        setShippingInformationAmazon();
+                if (amazonStorage.isAmazonAccountLoggedIn()) {
+                    if (customer.isLoggedIn() || this.validateGuestEmail()) {
+                        setShippingInformationAction().done(
+                            function () {
+                                stepNavigator.next();
+                            }
+                        );
                     }
-                    //if using guest checkout or guest checkout with amazon pay we need to use the main validation
-                } else if (this.validateShippingInformation()) {
-                    setShippingInformationAmazon();
+                } else {
+                    this._super();
                 }
             }
         });

--- a/view/frontend/web/template/checkout-button.html
+++ b/view/frontend/web/template/checkout-button.html
@@ -19,6 +19,8 @@
     <!-- ko template: getTemplate() --><!-- /ko -->
 <!--/ko-->
 
+<div class="amazon-express-title" data-bind="i18n: 'Express Checkout', visible: !isAmazonAccountLoggedIn() && isPwaVisible()"></div>
+
 <div class="amazon-button-container" data-bind="visible: !isAmazonAccountLoggedIn() && isPwaVisible()">
     <div class="amazon-button-container__cell">
         <div class="login-with-amazon" data-bind="attr: {id: 'PayWithAmazon_' + displayArea}, mageInit: {'amazonButton':{'buttonType': 'PwA'}}"></div>
@@ -32,6 +34,10 @@
     </div>
 </div>
 
+<div class="amazon-divider" data-bind="visible: !isAmazonAccountLoggedIn() && isPwaVisible()">
+    <span data-bind="i18n: 'Or continue below to pay with a credit card'"></span>
+</div>
+
 <!-- ko foreach: getRegion('after-amazon-button') -->
     <!-- ko template: getTemplate() --><!-- /ko -->
 <!--/ko-->

--- a/view/frontend/web/template/checkout-widget-address.html
+++ b/view/frontend/web/template/checkout-widget-address.html
@@ -27,6 +27,16 @@
     <div class="amazon-widget-container">
         <div id="addressBookWidgetDiv" class="amazon-widget amazon-widget--address" data-bind="afterRender: initAddressWidget"></div>
     </div>
+
+    <div class="methods-shipping" data-bind="visible: isShippingAddressReadOnly()">
+        <div class="actions-toolbar">
+            <button id="amazon-continue-payment" data-role="opc-continue" type="submit" class="button action primary"
+                    data-bind="click: continuePayment">
+                <span data-bind="i18n: 'Next'"></span>
+            </button>
+        </div>
+    </div>
+
 <!--/ko-->
 
 <!-- ko foreach: getRegion('after-widget-address') -->

